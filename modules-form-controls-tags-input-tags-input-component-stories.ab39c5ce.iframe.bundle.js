"use strict";(self.webpackChunkplatform_ui=self.webpackChunkplatform_ui||[]).push([[4244],{"./libs/ui/src/lib/modules/form-controls/tags-input/tags-input.component.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{T:()=>UiTagsInputComponent});var tslib_es6=__webpack_require__("./node_modules/tslib/tslib.es6.js");var UiTagsInputComponent_1,core=__webpack_require__("./node_modules/@angular/core/fesm2020/core.mjs"),fesm2020_forms=__webpack_require__("./node_modules/@angular/forms/fesm2020/forms.mjs"),Subject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subject.js"),merge=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/merge.js"),debounceTime=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/debounceTime.js"),distinctUntilChanged=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js"),filter=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/filter.js"),tap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/tap.js"),map=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/map.js");let UiTagsInputComponent=UiTagsInputComponent_1=class UiTagsInputComponent{constructor(){this.maxLength=null,this.minLength=null,this.optionItems=[],this.optionItemsLimit=10,this.searchPlaceholder="Search...",this.emptyStatePlaceholder="",this.enableFreeTextAdding=!0,this.enableMultipleSelect=!1,this.api={keyField:"id",labelField:"text"},this.validateItemCallback=null,this.itemsChanged=new core.EventEmitter,this.disabled=!1,this.isFocus=!1,this.touched=!1,this.selectedItems=[],this.selectedItemsBackup=[],this.optionItemsBackup=[],this.typeaheadModel={},this.focus$=new Subject.B,this.click$=new Subject.B,this._defaultColorClass="bg-primary",this._customErrorKey="",this.onTouched=()=>{},this.onChange=quantity=>{},this.onClick=$event=>{this.enableMultipleSelect&&this.click$.next($event.target.value)},this.typeaheadSearch=text$=>{const debouncedText$=text$.pipe((0,debounceTime.B)(200),(0,distinctUntilChanged.F)()),clicksWithClosedPopup$=this.enableMultipleSelect?this.click$:this.click$.pipe((0,filter.p)((()=>!this.instance.isPopupOpen()))),inputFocus$=this.focus$.pipe((0,tap.M)((()=>{this.isFocus=!0,this.markAsTouched()})));return(0,merge.h)(debouncedText$,inputFocus$,clicksWithClosedPopup$).pipe((0,tap.M)((term=>{""===term&&this.hasCustomValidationError(term)})),(0,map.T)((term=>{let options=this.optionItems.filter((v=>!this.disabled&&v&&v[this.api.labelField]&&(!term||v[this.api.labelField].toLowerCase().indexOf(term.toLowerCase())>-1)&&!this.selectedItems.some((s=>s[this.api.keyField]===v[this.api.keyField]))));return this.optionItemsLimit&&(options=options.slice(0,this.optionItemsLimit)),options})))},this.typeaheadFormatter=result=>result[this.api.labelField]}ngOnInit(){}writeValue(value){this.selectedItems=[],null!==value&&value.forEach((item=>{this.selectItem(item)}))}registerOnChange(onChange){this.onChange=onChange}registerOnTouched(onTouched){this.onTouched=onTouched}markAsTouched(){this.touched||(this.onTouched(),this.touched=!0)}setDisabledState(disabled){this.disabled=disabled,disabled||(this.optionItemsBackup=JSON.parse(JSON.stringify(this.optionItems)))}validate(control){const min=this.minLength,max=this.maxLength;return this.formField=control,null!==min&&this.selectedItems.length<min?{minLength:{min}}:null!==max&&this.selectedItems.length>max?{maxLength:{max}}:!this.enableFreeTextAdding&&"string"==typeof this.typeaheadModel&&this.typeaheadModel.length>0?{valid:!1}:void 0}onModelChange(){this.enableFreeTextAdding||this.formField.updateValueAndValidity()}selectItem(item){item&&(item.disabled=item.disabled||!1,item.colorClass=item.colorClass||this._defaultColorClass,this.selectedItems.push(item))}removeItem(item){this.disabled||item.disabled||(item.disabled=!1,this.selectedItems=this.selectedItems.filter((selectedItem=>selectedItem!==item)),this.markAsTouched(),this.itemsChanged.emit(this.selectedItems),this.onChange(this.selectedItems))}onTypeaheadSelectItem($event){if(this.disabled||!$event.item)return;$event.preventDefault();const key=this.api.keyField,label=this.api.labelField;this.selectedItems.push({[key]:$event.item[key],[label]:$event.item[label],disabled:"boolean"==typeof $event.item.disabled&&$event.item.disabled,colorClass:$event.item.colorClass||this._defaultColorClass}),this.itemsChanged.emit(this.selectedItems),this.onChange(this.selectedItems),this.markAsTouched(),this.typeaheadModel={},this.onModelChange()}onTypeaheadEnterPress($event){if(this.disabled||!this.enableFreeTextAdding)return;const text=$event.target.value;if(this.hasCustomValidationError(text))return;if(!text||!text.trim())return;if(this.selectedItems.some((s=>text.toLowerCase()===s[this.api.labelField].toLowerCase())))return;const newId=this.getNextAvailableItemId(this.optionItems,this.selectedItems),key=this.api.keyField,label=this.api.labelField;this.selectedItems.push({[key]:newId,[label]:text,disabled:!1,colorClass:this._defaultColorClass}),this.itemsChanged.emit(this.selectedItems),this.onChange(this.selectedItems),this.markAsTouched(),this.typeaheadModel={},this.onModelChange()}typeaheadOnBlur(){this.isFocus=!1}hasCustomValidationError(inputTagText){if("function"==typeof this.validateItemCallback){const customError=this.validateItemCallback(inputTagText);if(customError)return this._customErrorKey=Object.keys(customError)[0],this.formField.setErrors(customError),!0;this.formField.setErrors({[this._customErrorKey]:null}),this.formField.updateValueAndValidity()}return!1}getNextAvailableItemId(optionItems,selectedItems){return optionItems.length||Math.max(...selectedItems.map((item=>item.id)))+1}};UiTagsInputComponent.ctorParameters=()=>[],UiTagsInputComponent.propDecorators={maxLength:[{type:core.Input}],minLength:[{type:core.Input}],optionItems:[{type:core.Input}],optionItemsLimit:[{type:core.Input}],searchPlaceholder:[{type:core.Input}],emptyStatePlaceholder:[{type:core.Input}],enableFreeTextAdding:[{type:core.Input}],enableMultipleSelect:[{type:core.Input}],api:[{type:core.Input}],typeaheadContainer:[{type:core.Input}],validateItemCallback:[{type:core.Input}],itemsChanged:[{type:core.Output}],instance:[{type:core.ViewChild,args:["instance",{static:!0}]}]},UiTagsInputComponent=UiTagsInputComponent_1=(0,tslib_es6.Cg)([(0,core.Component)({selector:"ui-tags-input",template:'<div\n    #container\n    (click)="$event.stopPropagation()"\n    [ngClass]="{\n        \'disabled\': disabled,\n        \'is-invalid\': !disabled && formField !== undefined && formField.invalid && (formField.touched || formField.dirty),\n        \'is-valid\': !disabled && formField !== undefined && !formField.pristine && formField.valid,\n        \'container-focus\': !disabled && isFocus\n    }"\n    class="tag-container disable-select form-control"\n    >\n    <div\n        [openDelay]="600"\n        [closeDelay]="500"\n        placement="top"\n        [ngbTooltip]="item[api.labelField]"\n        *ngFor="let item of selectedItems"\n        [ngClass]="item.colorClass"\n        class="badge pe-1 ps-1 disable-select">\n        <span>{{item[api.labelField] | truncate:[20, \'...\']}}</span>\n        <span *ngIf="!disabled && !item.disabled" class="ps-1 pointer" (click)="$event.stopPropagation(); removeItem(item)">\n            <i class="bi bi-x-circle-fill"></i>\n        </span>\n    </div>\n    <input\n        *ngIf="!disabled"\n        type="text"\n        class="form-control"\n        [container]="typeaheadContainer"\n        [placeholder]="searchPlaceholder"\n        [(ngModel)]="typeaheadModel"\n        (ngModelChange)="onModelChange()"\n        [ngbTypeahead]="typeaheadSearch"\n        [inputFormatter]="typeaheadFormatter"\n        [resultFormatter]="typeaheadFormatter"\n        (focus)="focus$.next($any($event).target.value)"\n        (click)="onClick($event)"\n        (blur)="typeaheadOnBlur($event)"\n        (selectItem)="onTypeaheadSelectItem($event)"\n        (keydown.enter)="onTypeaheadEnterPress($event)"/>\n    \x3c!-- Empty state placeholder --\x3e\n    <input *ngIf="disabled && selectedItems.length === 0" class="form-control" [placeholder]="emptyStatePlaceholder" disabled/>\n</div>\n',providers:[{provide:fesm2020_forms.NG_VALUE_ACCESSOR,multi:!0,useExisting:UiTagsInputComponent_1},{provide:fesm2020_forms.NG_VALIDATORS,multi:!0,useExisting:UiTagsInputComponent_1}],styles:[".grid-item {\n  flex-grow: 1;\n  min-width: 10%;\n}\n\n.dropdown-toggle::after {\n  display: none;\n}\n\n.dropdown-menu {\n  width: 100%;\n  padding-left: 0.025em;\n}\n\n.badge {\n  align-items: center;\n  box-sizing: border-box;\n  display: flex;\n  flex-direction: row;\n  height: 24px;\n  place-content: center;\n}\n\n.tag-container {\n  align-items: center;\n  background-color: #fff;\n  border-radius: 5px;\n  border: 1px solid #dbdee1;\n  box-sizing: border-box;\n  display: flex;\n  flex-flow: row wrap;\n  gap: 0.25rem;\n  place-content: center flex-start;\n}\n\n.tag-container.disabled {\n  background-color: #edeff0;\n  opacity: 1;\n}\n\n.tag-container:invalid, .tag-container.is-invalid {\n  border-color: #E02A49;\n  padding-right: calc(1.5em + 0.75rem);\n  background-image: url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='none' stroke='%23ff4d4f' viewBox='0 0 12 12'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23ff4d4f' stroke='none'/%3e%3c/svg%3e\");\n  background-repeat: no-repeat;\n  background-position: right 10px center;\n  background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);\n}\n\n.tag-container:invalid.container-focus, .tag-container.is-invalid.container-focus {\n  border-color: #E02A49;\n  box-shadow: 0px 0px 0px 3px rgba(224, 42, 73, 0.2);\n}\n\n.tag-container:valid, .tag-container.is-valid {\n  border-color: #50955b;\n  padding-right: calc(1.5em + 0.75rem);\n  background-image: url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%2350955b' d='M2.3 6.73L.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e\");\n  background-repeat: no-repeat;\n  background-position: right 10px top 10px;\n  background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);\n}\n\n.tag-container:valid.container-focus, .tag-container.is-valid.container-focus {\n  border-color: #50955b;\n  box-shadow: 0px 0px 0px 3px rgba(80, 149, 91, 0.2);\n}\n\n.tag-container input {\n  border: none;\n  box-shadow: none;\n  outline: none;\n  background-color: transparent;\n  padding: 0 6px;\n  margin: 0;\n  flex: 1;\n  width: auto;\n  max-width: inherit;\n}\n\n.bs-tooltip-top .arrow,\n.bs-tooltip-auto[x-placement^=top] .arrow {\n  bottom: 2px;\n}\n\n.tooltip-inner {\n  max-width: 200px;\n  padding: 0.25rem 0.5rem;\n  color: #fff;\n  text-align: center;\n  background-color: #000;\n  border-radius: 0.25rem;\n}"]}),(0,tslib_es6.Sn)("design:paramtypes",[])],UiTagsInputComponent)},"./libs/ui/src/lib/modules/form-controls/tags-input/tags-input.component.stories.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Primary:()=>Primary,default:()=>__WEBPACK_DEFAULT_EXPORT__});var _storybook_angular__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@storybook/angular/dist/ts3.9/client/index.js"),_tags_input_component__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./libs/ui/src/lib/modules/form-controls/tags-input/tags-input.component.ts"),_angular_forms__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@angular/forms/fesm2020/forms.mjs"),_ng_bootstrap_ng_bootstrap__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@ng-bootstrap/ng-bootstrap/fesm2020/ng-bootstrap.mjs"),_ngx_translate_core__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@ngx-translate/core/__ivy_ngcc__/fesm2015/ngx-translate-core.js");const __WEBPACK_DEFAULT_EXPORT__={title:"Forms/TagsInput",component:_tags_input_component__WEBPACK_IMPORTED_MODULE_1__.T,decorators:[(0,_storybook_angular__WEBPACK_IMPORTED_MODULE_0__.moduleMetadata)({declarations:[_ng_bootstrap_ng_bootstrap__WEBPACK_IMPORTED_MODULE_2__.md],imports:[_angular_forms__WEBPACK_IMPORTED_MODULE_3__.FormsModule,_ngx_translate_core__WEBPACK_IMPORTED_MODULE_4__.h.forRoot({loader:{provide:_ngx_translate_core__WEBPACK_IMPORTED_MODULE_4__.Wr,useClass:_ngx_translate_core__WEBPACK_IMPORTED_MODULE_4__.dx}})]})]};class CustomFormGroup extends _angular_forms__WEBPACK_IMPORTED_MODULE_3__.FormGroup{toJSON(){return null}}new CustomFormGroup({text1:new _angular_forms__WEBPACK_IMPORTED_MODULE_3__.FormControl("")});const Primary=(args=>({props:args})).bind({});Primary.args={maxLength:null,minLength:null,optionItems:[],optionItemsLimit:10,searchPlaceholder:"Search...",emptyStatePlaceholder:"",enableFreeTextAdding:!0,enableMultipleSelect:!1,api:{keyField:"id",labelField:"text"},typeaheadContainer:"",validateItemCallback:null}}}]);